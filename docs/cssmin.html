<!DOCTYPE html>  <html> <head>   <title>cssmin.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="cssmin.html">                 cssmin.js               </a>                                           <a class="source" href="defer.html">                 defer.js               </a>                                           <a class="source" href="helpers.html">                 helpers.js               </a>                                           <a class="source" href="k.html">                 k.js               </a>                                           <a class="source" href="tasks.html">                 tasks.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               cssmin.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="cm">/**</span>
<span class="cm"> * cssmin.js</span>
<span class="cm"> * Author: Stoyan Stefanov - http://phpied.com/</span>
<span class="cm"> * This is a JavaScript port of the CSS minification tool</span>
<span class="cm"> * distributed with YUICompressor, itself a port</span>
<span class="cm"> * of the cssmin utility by Isaac Schlueter - http://foohack.com/</span>
<span class="cm"> * Permission is hereby granted to use the JavaScript version under the same</span>
<span class="cm"> * conditions as the YUICompressor (original YUICompressor note below).</span>
<span class="cm"> */</span>

<span class="cm">/*</span>
<span class="cm">* YUI Compressor</span>
<span class="cm">* http://developer.yahoo.com/yui/compressor/</span>
<span class="cm">* Author: Julien Lecomte - http://www.julienlecomte.net/</span>
<span class="cm">* Copyright (c) 2011 Yahoo! Inc. All rights reserved.</span>
<span class="cm">* The copyrights embodied in the content of this file are licensed</span>
<span class="cm">* by Yahoo! Inc. under the BSD (revised) open source license.</span>
<span class="cm">*/</span>
<span class="kd">var</span> <span class="nx">YAHOO</span> <span class="o">=</span> <span class="nx">YAHOO</span> <span class="o">||</span> <span class="p">{};</span>
<span class="nx">YAHOO</span><span class="p">.</span><span class="nx">compressor</span> <span class="o">=</span> <span class="nx">YAHOO</span><span class="p">.</span><span class="nx">compressor</span> <span class="o">||</span> <span class="p">{};</span>
<span class="nx">YAHOO</span><span class="p">.</span><span class="nx">compressor</span><span class="p">.</span><span class="nx">cssmin</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">css</span><span class="p">,</span> <span class="nx">linebreakpos</span><span class="p">)</span> <span class="p">{</span>

    <span class="kd">var</span> <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">endIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">preservedTokens</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">comments</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">token</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">totallen</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">placeholder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>collect all comment blocks...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">while</span> <span class="p">((</span><span class="nx">startIndex</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;/*&quot;</span><span class="p">,</span> <span class="nx">startIndex</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">endIndex</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;*/&quot;</span><span class="p">,</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">endIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">endIndex</span> <span class="o">=</span> <span class="nx">totallen</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">token</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">startIndex</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="nx">endIndex</span><span class="p">);</span>
        <span class="nx">comments</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
        <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">startIndex</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">comments</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span> <span class="o">+</span> <span class="nx">css</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">endIndex</span><span class="p">);</span>
        <span class="nx">startIndex</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>preserve strings so their content doesn't get accidentally minified</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(&quot;([^\\&quot;]|\\.|\\)*&quot;)|(&#39;([^\\&#39;]|\\.|\\)*&#39;)/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">max</span><span class="p">,</span> <span class="nx">quote</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>

        <span class="nx">match</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>maybe the string contains a comment-like substring?
one, maybe more? put'em back then</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_&quot;</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">,</span> <span class="nx">comments</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>minify alpha opacity in filter strings</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">match</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/progid:DXImageTransform\.Microsoft\.Alpha\(Opacity=/gi</span><span class="p">,</span> <span class="s2">&quot;alpha(opacity=&quot;</span><span class="p">);</span>

        <span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">quote</span> <span class="o">+</span> <span class="s2">&quot;___YUICSSMIN_PRESERVED_TOKEN_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span> <span class="o">+</span> <span class="nx">quote</span><span class="p">;</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>strings are safe, now wrestle the comments</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

        <span class="nx">token</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">placeholder</span> <span class="o">=</span> <span class="s2">&quot;___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>! in the first position of the comment means preserve
so push to the preserved tokens keeping the !</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;!&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">token</span><span class="p">);</span>
            <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span>  <span class="s2">&quot;___YUICSSMIN_PRESERVED_TOKEN_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">);</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>\ in the last position looks like hack for Mac/IE5
shorten that to /<em>*/ and the next one to /</em>*/</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;\\&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;\\&quot;</span><span class="p">);</span>
            <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span>  <span class="s2">&quot;___YUICSSMIN_PRESERVED_TOKEN_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">);</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// attn: advancing the loop</span>
            <span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
            <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">,</span>  <span class="s2">&quot;___YUICSSMIN_PRESERVED_TOKEN_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">);</span>
            <span class="k">continue</span><span class="p">;</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>keep empty comments after child selectors (IE7 hack)
e.g. html >/**/ body</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">token</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">startIndex</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">startIndex</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">css</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">startIndex</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">);</span>
                    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span>  <span class="s2">&quot;___YUICSSMIN_PRESERVED_TOKEN_&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>in all other cases kill the comment</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;/*&quot;</span> <span class="o">+</span> <span class="nx">placeholder</span> <span class="o">+</span> <span class="s2">&quot;*/&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Normalize all whitespace strings to single spaces. Easier to work with that way.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Remove the spaces before the things that should not have spaces before them.
But, be careful not to turn "p :link {...}" into "p:link{...}"
Swap out any pseudo-class colons with the token, and then swap back.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^|\})(([^\{:])+:)+([^\{]*\{)/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">m</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;___YUICSSMIN_PSEUDOCLASSCOLON___&quot;</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+([!{};:&gt;+\(\)\],])/g</span><span class="p">,</span> <span class="s1">&#39;$1&#39;</span><span class="p">);</span>
    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/___YUICSSMIN_PSEUDOCLASSCOLON___/g</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>retain space for special IE6 cases</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/:first-(line|letter)(\{|,)/g</span><span class="p">,</span> <span class="s2">&quot;:first-$1 $2&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>no space after the end of a preserved comment</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\*\/ /g</span><span class="p">,</span> <span class="s1">&#39;*/&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>If there is a @charset, then only allow one, and push to the top of the file.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(.*)(@charset &quot;[^&quot;]*&quot;;)/gi</span><span class="p">,</span> <span class="s1">&#39;$2$1&#39;</span><span class="p">);</span>
    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^(\s*@charset [^;]+;\s*)+/gi</span><span class="p">,</span> <span class="s1">&#39;$1&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Put the space back in some cases, to support stuff like
@media screen and (-webkit-min-device-pixel-ratio:0){</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\band\(/gi</span><span class="p">,</span> <span class="s2">&quot;and (&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>Remove the spaces after the things that should not have spaces after them.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([!{}:;&gt;+\(\[,])\s+/g</span><span class="p">,</span> <span class="s1">&#39;$1&#39;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>remove unnecessary semicolons</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/;+\}/g</span><span class="p">,</span> <span class="s2">&quot;}&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Replace 0(px,em,%) with 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([\s:])(0)(px|em|%|in|cm|mm|pc|pt|ex)/gi</span><span class="p">,</span> <span class="s2">&quot;$1$2&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Replace 0 0 0 0; with 0.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/:0 0 0 0(;|\})/g</span><span class="p">,</span> <span class="s2">&quot;:0$1&quot;</span><span class="p">);</span>
    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/:0 0 0(;|\})/g</span><span class="p">,</span> <span class="s2">&quot;:0$1&quot;</span><span class="p">);</span>
    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/:0 0(;|\})/g</span><span class="p">,</span> <span class="s2">&quot;:0$1&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Replace background-position:0; with background-position:0 0;
same for transform-origin</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(background-position|transform-origin|webkit-transform-origin|moz-transform-origin|o-transform-origin|ms-transform-origin):0(;|\})/gi</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">tail</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;:0 0&quot;</span> <span class="o">+</span> <span class="nx">tail</span><span class="p">;</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Replace 0.6 to .6, but only when preceded by : or a white-space</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(:|\s)0+\.(\d+)/g</span><span class="p">,</span> <span class="s2">&quot;$1.$2&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Shorten colors from rgb(51,102,153) to #336699
This makes it more likely that it'll get further compressed in the next step.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/rgb\s*\(\s*([0-9,\s]+)\s*\)/gi</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">rgbcolors</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rgbcolors</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">rgbcolors</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">rgbcolors</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="mi">10</span><span class="p">).</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">rgbcolors</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">rgbcolors</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="nx">rgbcolors</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">rgbcolors</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Shorten colors from #AABBCC to #ABC. Note that we want to make sure
the color is not preceded by either ", " or =. Indeed, the property
    filter: chroma(color="#FFFFFF");
would become
    filter: chroma(color="#FFF");
which makes the filter break in IE.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/([^&quot;&#39;=\s])(\s*)#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])/gi</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">group</span> <span class="o">=</span> <span class="nx">arguments</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="nx">group</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="nx">group</span><span class="p">[</span><span class="mi">4</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
            <span class="nx">group</span><span class="p">[</span><span class="mi">5</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="nx">group</span><span class="p">[</span><span class="mi">6</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
            <span class="nx">group</span><span class="p">[</span><span class="mi">7</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">===</span> <span class="nx">group</span><span class="p">[</span><span class="mi">8</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">()</span>
        <span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="p">(</span><span class="nx">group</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">group</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">group</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nx">group</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="nx">group</span><span class="p">[</span><span class="mi">7</span><span class="p">]).</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">group</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>border: none -> border:0</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(border|border-top|border-right|border-bottom|border-right|outline|background):none(;|\})/gi</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">all</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">tail</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;:0&quot;</span> <span class="o">+</span> <span class="nx">tail</span><span class="p">;</span>
    <span class="p">});</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>shorter opacity IE filter</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/progid:DXImageTransform\.Microsoft\.Alpha\(Opacity=/gi</span><span class="p">,</span> <span class="s2">&quot;alpha(opacity=&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Remove empty rules.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[^\};\{\/]+\{\}/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">linebreakpos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Some source control tools don't like it when files containing lines longer
than, say 8000 characters, are checked in. The linebreak option is used in
that case to split long lines after a specific column.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">css</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">css</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;}&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">i</span> <span class="o">-</span> <span class="nx">startIndex</span> <span class="o">&gt;</span> <span class="nx">linebreakpos</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;\n&#39;</span> <span class="o">+</span> <span class="nx">css</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                <span class="nx">startIndex</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Replace multiple semi-colons in a row by a single one
See SF bug #1980989</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/;;+/g</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>restore preserved comments and strings</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">max</span> <span class="o">=</span> <span class="nx">preservedTokens</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">max</span><span class="p">;</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;___YUICSSMIN_PRESERVED_TOKEN_&quot;</span> <span class="o">+</span> <span class="nx">i</span> <span class="o">+</span> <span class="s2">&quot;___&quot;</span><span class="p">,</span> <span class="nx">preservedTokens</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Trim the final string (for any leading or trailing white spaces)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">css</span> <span class="o">=</span> <span class="nx">css</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\s+|\s+$/g</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">css</span><span class="p">;</span>

<span class="p">};</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">cssmin</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cssmin</span> <span class="o">=</span> <span class="nx">YAHOO</span><span class="p">.</span><span class="nx">compressor</span><span class="p">.</span><span class="nx">cssmin</span><span class="p">;</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 